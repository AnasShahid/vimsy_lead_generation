---
phase: 1
plan: 1
name: Provider Revamp — Remove Google Search, Add Hunter.io Lead Import
wave: 1
depends_on: none
autonomous: true
---

# Phase 1 Plan 1: Provider Revamp

## Objective

Remove the unreliable Google Search discovery provider and replace it with a Hunter.io lead list import provider. The Hunter.io provider connects to the Leads API, lets the user select a lead list, and imports company domains into the discovery pipeline for WordPress detection.

## Context

**Requirements addressed:** REQ-012
**Phase goal contribution:** Swaps out a broken provider for a useful one, expanding discovery sources.

## Tasks

### Task 1: Remove Google Search provider from server

**Files:** `server/src/services/discovery/providers/google-search.ts`, `server/src/services/discovery/index.ts`, `server/src/routes/discovery.ts`, `shared/types.ts`

**Action:**
1. Delete `server/src/services/discovery/providers/google-search.ts`
2. In `shared/types.ts`:
   - Remove `'google'` from `DiscoveryProvider` union type
   - Remove `GoogleSearchProviderConfig` interface
   - Remove `GoogleSearchProviderConfig` from `ProviderConfig` union
3. In `server/src/services/discovery/index.ts`:
   - Remove `GoogleSearchProvider` import
   - Remove `google: new GoogleSearchProvider()` from providers registry
4. In `server/src/routes/discovery.ts`:
   - Remove `'google'` from `VALID_PROVIDERS` array

**Verify:**
```bash
grep -r "google" server/src/services/discovery/ --include="*.ts"
grep -r "GoogleSearch" shared/types.ts
# Both should return no results
```

**Done when:**
- `google-search.ts` file no longer exists
- No references to `google` or `GoogleSearch` in provider registry, types, or routes
- TypeScript compiles without errors

---

### Task 2: Remove Google Search UI component

**Files:** `client/src/components/discovery/GoogleSearchForm.tsx`, `client/src/pages/DiscoveryPage.tsx`

**Action:**
1. Delete `client/src/components/discovery/GoogleSearchForm.tsx`
2. In `client/src/pages/DiscoveryPage.tsx`:
   - Remove `GoogleSearchForm` import
   - Remove the `{ key: 'google', label: 'Google Search', icon: <Globe size={16} /> }` entry from `TABS` array
   - Remove the `{activeTab === 'google' && ...}` conditional render block
   - Remove `'google'` from `ProviderTab` type
   - Remove unused `Globe` import from lucide-react if no longer used

**Verify:**
```bash
grep -r "GoogleSearch" client/src/ --include="*.tsx"
grep -r "google" client/src/pages/DiscoveryPage.tsx
# Both should return no results
```

**Done when:**
- `GoogleSearchForm.tsx` file no longer exists
- No references to Google Search in DiscoveryPage
- Client compiles without errors

---

### Task 3: Create Hunter.io lead list import provider (server)

**Files:** `server/src/services/discovery/providers/hunter-leads.ts`, `server/src/services/discovery/index.ts`, `server/src/routes/discovery.ts`, `shared/types.ts`, `.env.example`

**Action:**
1. In `shared/types.ts`:
   - Add `'hunter'` to `DiscoveryProvider` union type
   - Add `HunterLeadsProviderConfig` interface:
     ```typescript
     export interface HunterLeadsProviderConfig {
       apiKey: string;
       listId: number;  // selected lead list ID
     }
     ```
   - Add `HunterLeadsProviderConfig` to `ProviderConfig` union
   - Add `HunterLeadList` interface for the list selection API:
     ```typescript
     export interface HunterLeadList {
       id: number;
       name: string;
       leads_count: number;
     }
     ```

2. Create `server/src/services/discovery/providers/hunter-leads.ts`:
   - Implements `IDiscoveryProvider` interface
   - `name = 'hunter'`, `requiresApiKey = true`
   - `discover()` method:
     - Calls `GET https://api.hunter.io/v2/leads_lists/{listId}/leads?api_key={apiKey}&limit=100&offset=0` (paginate if >100)
     - For each lead, extract `company` and `website_url` or construct domain from `company_domain`
     - Return as `DiscoveredUrl[]` with `source: 'hunter'` and metadata containing company name
     - Handle pagination: keep fetching until all leads retrieved
     - Respect AbortSignal for cancellation
     - Report progress via onProgress callback
   - `validate()` method: check apiKey is non-empty, listId is a positive number

3. Add a new route for listing Hunter.io lead lists (needed by the UI dropdown):
   - In `server/src/routes/discovery.ts`, add:
     ```
     GET /api/discovery/hunter/lists?apiKey=...
     ```
   - Calls `GET https://api.hunter.io/v2/leads_lists?api_key={apiKey}`
   - Returns `{ success: true, data: HunterLeadList[] }`

4. Register provider:
   - In `server/src/services/discovery/index.ts`: import and add `hunter: new HunterLeadsProvider()`
   - In `server/src/routes/discovery.ts`: add `'hunter'` to `VALID_PROVIDERS`

5. Update `.env.example`: rename `HUNTER_API_KEY` comment to clarify it's used for both discovery (lead lists) and enrichment

**Verify:**
```bash
# TypeScript compilation
cd server && npx tsc --noEmit
# Check provider registered
grep "hunter" server/src/services/discovery/index.ts
```

**Done when:**
- Hunter.io provider file exists and implements IDiscoveryProvider
- `/api/discovery/hunter/lists` endpoint returns lead lists
- Provider registered in index.ts and VALID_PROVIDERS
- TypeScript compiles without errors

---

### Task 4: Create Hunter.io lead list UI component

**Files:** `client/src/components/discovery/HunterLeadsForm.tsx`, `client/src/pages/DiscoveryPage.tsx`

**Action:**
1. Create `client/src/components/discovery/HunterLeadsForm.tsx`:
   - Props: `onSubmit: (config: { apiKey: string; listId: number }) => void`, `loading: boolean`
   - State: `apiKey` (text input), `lists` (fetched from API), `selectedListId`, `loadingLists`
   - UI flow:
     a. User enters Hunter.io API key
     b. "Fetch Lists" button calls `GET /api/discovery/hunter/lists?apiKey=...`
     c. Dropdown populates with list names and lead counts
     d. User selects a list and clicks "Import Leads"
     e. Calls `onSubmit({ apiKey, listId: selectedListId })`
   - Style: Match existing form patterns (BuiltWithForm, WappalyzerForm)
   - Show lead count next to each list name in dropdown

2. In `client/src/pages/DiscoveryPage.tsx`:
   - Import `HunterLeadsForm`
   - Add `'hunter'` to `ProviderTab` type
   - Add `{ key: 'hunter', label: 'Hunter.io Leads', icon: <Search size={16} /> }` to TABS (replace Google's position)
   - Add conditional render: `{activeTab === 'hunter' && <HunterLeadsForm ... />}`
   - Use a relevant lucide icon (e.g., `Users` or `UserSearch`)

**Verify:**
```bash
grep -r "HunterLeads" client/src/ --include="*.tsx"
# Should show import in DiscoveryPage and the component file
```

**Done when:**
- HunterLeadsForm component renders with API key input, list fetcher, and list selector
- Tab appears in DiscoveryPage replacing Google Search
- Submitting the form creates a discovery job with provider='hunter'
- Client compiles without errors

---

## Verification

After all tasks complete:

```bash
# Server compiles
cd server && npx tsc --noEmit

# Client compiles  
cd client && npx tsc --noEmit

# No Google references remain
grep -r "google" server/src/ client/src/ shared/ --include="*.ts" --include="*.tsx" -l

# Hunter provider registered
grep "hunter" server/src/services/discovery/index.ts
grep "hunter" shared/types.ts
```

## Success Criteria

- [ ] Google Search provider fully removed (server + client + types)
- [ ] Hunter.io lead list provider created and registered
- [ ] Hunter.io list selection endpoint works (`GET /api/discovery/hunter/lists`)
- [ ] HunterLeadsForm UI component created with API key + list selector flow
- [ ] DiscoveryPage tabs updated (Google removed, Hunter.io added)
- [ ] TypeScript compiles on both server and client

## Output

**Files created:**
- `server/src/services/discovery/providers/hunter-leads.ts` — Hunter.io lead list discovery provider
- `client/src/components/discovery/HunterLeadsForm.tsx` — Hunter.io lead list selection form

**Files modified:**
- `shared/types.ts` — Remove Google types, add Hunter types
- `server/src/services/discovery/index.ts` — Swap Google for Hunter in registry
- `server/src/routes/discovery.ts` — Update VALID_PROVIDERS, add hunter lists endpoint
- `client/src/pages/DiscoveryPage.tsx` — Swap Google tab for Hunter.io tab
- `.env.example` — Update Hunter.io API key comment

**Files deleted:**
- `server/src/services/discovery/providers/google-search.ts`
- `client/src/components/discovery/GoogleSearchForm.tsx`
